(()=>{var y=class{static id;get mytype(){return this.constructor}get typename(){return this.mytype.id}toJSON(){return{type:this.typename}}static fromJSON(t,e){return new t}};function O(n){let t=k[n.type];return t.fromJSON(t,n)}var k={};function u(n,t){k[t]=n,n.id=t}var L=class extends y{},g=class extends L{},J=class extends g{};u(J,"Rocket");var j=class extends g{};u(j,"Fuel");var M=class extends y{cellName="";onEnter(t){}},x=class extends M{},v=class extends x{};u(v,"Airlock");var T=class extends x{};u(T,"Passage");var p=class extends x{opposite="";onEnter(t){t.getElementsByTagName("b")[0].innerText=this.opposite||""}};u(p,"Ballast");var R=class n extends x{original="";toJSON(){return{type:this.typename,original:this.original}}static fromJSON(t,e){let o=new n;return o.original=e.original,o}};u(R,"Debris");var C=class extends M{},D=class n extends C{cargo=[];toJSON(){return{type:this.typename,cargo:this.cargo.map(t=>t.toJSON())}}static fromJSON(t,e){let o=new n;return o.cargo=e.cargo.map(s=>O(s)),o}onEnter(t){t.getElementsByTagName("ul")[0].innerHTML=this.cargo.map(e=>`<li>${e.typename}</li>`).join(""),t.getElementsByClassName("CargoBay_Empty")[0].style.display=this.cargo.length==0?"":"none",t.getElementsByClassName("CargoBay_NonEmpty")[0].style.display=this.cargo.length==0?"none":""}};u(D,"CargoBay");function A(n,t){return n>t&&([n,t]=[t,n]),Math.floor(Math.random()*(t-n+1))+n}function z(n){return n[Math.floor(Math.random()*n.length)]}var b=class n{isAlien=!1;rows=[];offsets=[];toJSON(){return{isAlien:this.isAlien,offsets:this.offsets,rows:this.rows.map(t=>t.map(e=>e.toJSON()))}}static fromJSON(t){let e=new n;return e.isAlien=t.isAlien,e.offsets=t.offsets,e.rows=t.rows.map(o=>o.map(s=>O(s))),e}get gridSize(){if(this.isAlien)return{x0:0,x1:0,y0:0,y1:0,w:0,h:0};{let t=0,e=0;for(let o=0;o<this.rows.length;o++)t=Math.max(t,this.rows[o].length-this.offsets[o]),e=Math.max(e,this.offsets[o]);return{x0:0,x1:this.rows.length-1,y0:t,y1:e,w:this.rows.length,h:t+e+1}}}rowToXY(t,e){return this.isAlien?{x:0,y:0}:e>=this.offsets[t]?{x:t,y:1+(e-this.offsets[t])}:{x:t,y:e-this.offsets[t]}}get passage(){return this.isAlien?{x:0,y:0,w:0,h:0}:{x:0,y:0,w:this.rows.length,h:1}}oppositeComponent(t){for(let e=0;e<=this.rows.length;e++){let o=this.rows[e].indexOf(t);if(o>=0)return this.rows[this.rows.length-1-e][o]}}static randomShip(t){let o=Object.values(k).filter(i=>i.prototype instanceof C),s=Object.values(k).filter(i=>i.prototype instanceof g),r=new n;r.rows=[[],[],[],[]],r.offsets=[0,0,0,0];for(let i=0;i<t;i++){let h=A(0,3),l=z(o),S=new l;if(S instanceof D){let H=A(0,4);for(let G=0;G<H;G++){let P=z(s);S.cargo.push(new P)}}r.rows[h].push(S)}for(let i=0;i<r.rows.length;i++)r.offsets[i]=A(0,r.rows[i].length);return r.balanceBallast(),r}balanceBallast(){if(!this.isAlien){let o=this.rows.length-1;for(var t=0;t<=o;t++)for(;this.offsets[t]<this.offsets[o-t];)this.rows[t].unshift(new p),this.offsets[t]++;for(var t=0;t<=o;t++)for(;this.rows[t].length<this.rows[o-t].length;)this.rows[t].push(new p);for(var t=0;t<=o;t++)for(;this.rows[t][0]instanceof p&&this.rows[o-t][0]instanceof p;)this.rows[t].shift(),this.rows[o-t].shift(),this.offsets[t]--,this.offsets[o-t]++;for(var t=0;t<=o;t++)for(;this.rows[t].at(-1)instanceof p&&this.rows[o-t].at(-1)instanceof p;)this.rows[t].pop(),this.rows[o-t].pop();for(var t=0;t<=o;t++)for(var e=0;e<=this.rows[t].length;e++)this.rows[t][e]instanceof p&&(this.rows[t][e].opposite=this.rows[o-t][e].typename)}}get topAirlock(){if(this.isAlien)return 0;{let t=0;for(let e=0;e<this.rows.length;e++)t=Math.max(t,this.rows[e].length-this.offsets[e]);for(let e=0;e<this.rows.length;e++)if(this.rows[e].length-this.offsets[e]==t)return e;return 0}}get bottomAirlock(){if(this.isAlien)return 0;{let t=Math.max(...this.offsets);return this.offsets.lastIndexOf(t)}}};var a=50,m=5;function F(n,t,e,o,s,r){o.isAlien?n.rect(t*a,e*a+m,a,a-2*m):n.rect(t*a+m,e*a,a-2*m,a),n.strokeStyle="white",n.fillStyle="white",n.stroke(),n.textBaseline="top",n.fillText(s.cellName||"",t*a+m,e*a),n.fillText(s.typename[0],t*a+m,e*a+16),r&&(r.map[t][e].canBeHere=!0,r.map[t][e].canGoX=o.isAlien,r.map[t][e].canGoY=!o.isAlien,r.map[t][e].ship=o,r.map[t][e].component=s)}function q(n,t,e,o,s){let r=o.passage;if(n.rect((t+r.x)*a,(e+r.y)*a,r.w*a,r.h*a),n.strokeStyle="white",n.fillStyle="white",n.stroke(),n.textBaseline="top",s){let i=new T;for(let h=0;h<r.w;h++)for(let l=0;l<r.h;l++)s.map[h+t][l+e].canBeHere=!0,s.map[h+t][l+e].canGoX=!0,s.map[h+t][l+e].canGoY=!0,s.map[h+t][l+e].ship=o,s.map[h+t][l+e].component=i}}function X(n,t,e,o){n.strokeStyle="white",n.strokeStyle="white",n.fillStyle="white",n.beginPath(),n.moveTo(t*a+m,e*a),n.lineTo(t*a+m*2,(e+.5)*a),n.lineTo(t*a+m,(e+1)*a),n.lineTo((t+1)*a-m,(e+1)*a),n.lineTo((t+1)*a-m*2,(e+.5)*a),n.lineTo((t+1)*a-m,e*a),n.closePath(),n.stroke(),o&&(o.map[t][e].canBeHere=!0,o.map[t][e].canGoY=!0,o.map[t][e].component=new v)}function E(n,t,e,o,s){for(let r=0;r<o.rows.length;r++)for(let i=0;i<o.rows[r].length;i++){let h=o.rows[r][i],l=o.rowToXY(r,i);h.cellName=String.fromCharCode(65+r)+l.y,F(n,t+l.x,e-l.y,o,h,s)}q(n,t,e,o,s)}var W=class{canBeHere=!1;canGoX=!1;canGoY=!1;ship;component},_=class{map=[];constructor(t,e){for(let o=0;o<=t;o++){this.map[o]=[];for(let s=0;s<=e;s++)this.map[o][s]=new W}}},N=class{x;y;map;box;human;canvas;onEnter;goX(t){return!this.map.map[this.x][this.y].canGoX||!this.map.map[this.x+t][this.y].canBeHere?!1:(this.x+=t,this.reposition(),this.onEnter(this.map.map[this.x][this.y].component),!0)}goY(t,e){return!e&&!this.map.map[this.x][this.y].canGoY||!this.map.map[this.x][this.y+t].canBeHere?!1:(this.y+=t,this.reposition(),this.onEnter(this.map.map[this.x][this.y].component),!0)}goUp(){this.goY(-1),this.human.style.transform="rotate(-90deg)"}goDn(t){this.goY(1,t),this.human.style.transform="rotate(90deg)"}goLt(){this.goX(-1),this.human.style.transform="rotate(180deg)"}goRt(){this.goX(1),this.human.style.transform="rotate(0deg)"}jumpTo(t,e,o,s){o!==void 0&&s!==void 0||(this.x=t,this.y=e,this.reposition(!0),this.onEnter(this.map.map[t][e].component))}reposition(t){t&&this.canvas.classList.add("notransition");let e=(this.x+.5)*a,s=this.box.offsetWidth/2-e;this.canvas.style.left=s+"px";let r=(this.y+.5)*a,h=this.box.offsetHeight/2-r;this.canvas.style.top=h+"px",t&&(this.canvas.offsetHeight,this.canvas.classList.remove("notransition"))}};var B=class{walker;oneShipData;twoShipsData;myShip;putTwoShips(t,e){let o=t.gridSize,s=e.gridSize,r=t.bottomAirlock,i=e.topAirlock,h=Math.max(r,i)+1,l=o.h+1,S=h+Math.max(o.w-r,s.w-i),H=l+s.h+1;this.twoShipsData={ax0:h-r+o.x0,ay0:o.y0+1,airlock_x:h,airlock_y:l,bx0:h-i+s.x0,by0:l+s.y0+1,max_x:S,max_y:H}}drawTwoShips(t,e,o){this.putTwoShips(e,o);let s=this.twoShipsData,r=new _(s.max_x,s.max_y);this.walker.map=r,t.canvas.width=a*(s.max_x+1),t.canvas.height=a*(s.max_y+1),E(t,s.ax0,s.ay0,e,r),E(t,s.bx0,s.by0,o,r),X(t,s.airlock_x,s.airlock_y,r)}drawMyShip(t){let e=this.oneShipData=this.myShip.gridSize,o=this.walker.map=new _(e.w+1,e.h+1);t.canvas.width=a*(e.w+2),t.canvas.height=a*(e.h+2),E(t,e.x0+1,e.y0+1,this.myShip,o)}detach(t){let e=this.walker.x-this.twoShipsData.bx0,o=this.walker.y-this.twoShipsData.by0+1;this.drawMyShip(t),this.walker.jumpTo(this.oneShipData.x0+1+e,this.oneShipData.y0+o),this.walker.goDn(!0)}attach(t,e){let o=this.walker.x-1-this.oneShipData.x0,s=this.walker.y-1-this.oneShipData.y0;this.drawTwoShips(t,e,this.myShip),this.walker.jumpTo(this.twoShipsData.bx0+o,this.twoShipsData.by0+s)}};function f(n){let t=document.getElementById(n);if(!t)throw ReferenceError(`element ${n} not found`);return t}function Tt(n){let t=f(n);if(!(t instanceof HTMLInputElement))throw ReferenceError(`element ${n} is not input`);return t}(location.hostname=="localhost"||location.hostname=="127.0.0.1")&&new EventSource("/esbuild").addEventListener("change",()=>location.reload());var U=b.randomShip(15),Ct=b.randomShip(35),c=new N,w=new B;w.walker=c;var $=f("myCanvas"),Y=$.getContext("2d");c.box=f("canvasBox");c.human=f("human");c.canvas=$;c.onEnter=Q;function K(){w.myShip=U,w.drawMyShip(Y),c.jumpTo(w.oneShipData.x0+1,w.oneShipData.y0+1),I()}function I(){w.attach(Y,b.randomShip(25)),d("Docked to another ship")}K();window.onkeypress=n=>{switch(n.key){case"w":c.goUp();break;case"a":c.goLt();break;case"s":c.goDn();break;case"d":c.goRt();break}};function Q(n){if(!n)return;f("currentComponent").innerHTML=`#${n.typename} {display:block}`;let t=f(n.typename);n.cellName?f("componentLegend").innerText=`${n.cellName}: ${n.typename}`:f("componentLegend").innerText=`${n.typename}`,n.onEnter(t)}function d(n){f("status").innerText=n}f("Airlock_Detach").onclick=()=>{w.detach(Y),d("Docking to next ship in 5..."),setTimeout(()=>d("Docking to next ship in 4..."),1e3),setTimeout(()=>d("Docking to next ship in 3..."),2e3),setTimeout(()=>d("Docking to next ship in 2..."),3e3),setTimeout(()=>d("Docking to next ship in 1..."),4e3),setTimeout(()=>I(),5e3)};})();
//# sourceMappingURL=script.js.map
