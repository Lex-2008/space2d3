(()=>{var g=class{static id;get mytype(){return this.constructor}get typename(){return this.mytype.id}toJSON(){return{type:this.typename}}static fromJSON(e,t){return new e}};function E(r){let e=_[r.type];return e.fromJSON(e,r)}var _={};function m(r,e){_[e]=r,r.id=e}var d=class extends g{},N=class extends d{},X=class extends N{};m(X,"Rocket");var F=class extends N{};m(F,"Fuel");var w=class extends d{},b=class extends w{static color="blue"};m(b,"Water");var S=class extends w{static color="yellow"};m(S,"Iron");var B=class extends w{static color="green"};m(B,"Food");var O=class extends w{static color="red"};m(O,"Radioactives");var i=50,p=5;function se(r,e,t,n,o,a){n.isAlien?r.rect(e*i,t*i+p,i,i-2*p):r.rect(e*i+p,t*i,i-2*p,i),r.strokeStyle="white",r.fillStyle="white",r.stroke(),r.textBaseline="top",r.fillText(o.cellName||"",e*i+p,t*i),r.fillText(o.typename[0],e*i+p,t*i+16),a&&(a.map[e][t].canBeHere=!0,a.map[e][t].canGoX=n.isAlien,a.map[e][t].canGoY=!n.isAlien,a.map[e][t].ship=n,a.map[e][t].component=o)}function ie(r,e,t,n,o){let a=n.passage;if(r.rect((e+a.x)*i,(t+a.y)*i,a.w*i,a.h*i),r.strokeStyle="white",r.fillStyle="white",r.stroke(),r.textBaseline="top",o){let s=new A;for(let h=0;h<a.w;h++)for(let l=0;l<a.h;l++)o.map[h+e][l+t].canBeHere=!0,o.map[h+e][l+t].canGoX=!0,o.map[h+e][l+t].canGoY=!0,o.map[h+e][l+t].ship=n,o.map[h+e][l+t].component=s}}function Z(r,e,t,n){r.strokeStyle="white",r.strokeStyle="white",r.fillStyle="white",r.beginPath(),r.moveTo(e*i+p,t*i),r.lineTo(e*i+p*2,(t+.5)*i),r.lineTo(e*i+p,(t+1)*i),r.lineTo((e+1)*i-p,(t+1)*i),r.lineTo((e+1)*i-p*2,(t+.5)*i),r.lineTo((e+1)*i-p,t*i),r.closePath(),r.stroke(),n&&(n.map[e][t].canBeHere=!0,n.map[e][t].canGoY=!0,n.map[e][t].component=new L)}function H(r,e,t,n,o){for(let a=0;a<n.rows.length;a++)for(let s=0;s<n.rows[a].length;s++){let h=n.rows[a][s],l=n.rowToXY(a,s);h.cellName=String.fromCharCode(65+a)+l.y,se(r,e+l.x,t-l.y,n,h,o)}ie(r,e,t,n,o)}function le(r,e,t,n){let o=e.x*t,a=e.y*t;var s=r.createRadialGradient(o-1,a-1,2,o,a,n);s.addColorStop(0,e.color_in),s.addColorStop(1,e.color_out),r.fillStyle=s,r.beginPath(),r.arc(o,a,n,0,6),r.fill()}function ee(r,e){let t=r.canvas.width,n=t/e.size,o=n/5,a=t/2;if(r.clearRect(0,0,t,t),e.bright){let s=r.createRadialGradient(a,a,0,a,a,n/2);s.addColorStop(0,"white"),s.addColorStop(.5,e.color),s.addColorStop(1,"transparent"),r.fillStyle=s,r.fillRect(0,0,t,t)}else{let s=r.createRadialGradient(a,a,10,a,a,n/2);s.addColorStop(0,e.color),s.addColorStop(1,"transparent"),r.fillStyle=s,r.fillRect(0,0,t,t)}for(let s of e.planets)le(r,s,n,o)}var W=class extends g{cellName="";onEnter(e){}},x=class extends W{},L=class extends x{};m(L,"Airlock");var A=class extends x{};m(A,"Passage");var c=class extends x{opposite="";onEnter(e){document.querySelector("#Ballast b").innerText=this.opposite||""}};m(c,"Ballast");var $=class r extends x{original="";toJSON(){return{type:this.typename,original:this.original}}static fromJSON(e,t){let n=new r;return n.original=t.original,n}};m($,"Debris");var v=class extends W{},G=class r extends v{cargo=[];toJSON(){return{type:this.typename,cargo:this.cargo.map(e=>e.toJSON())}}static fromJSON(e,t){let n=new r;return n.cargo=t.cargo.map(o=>E(o)),n}onEnter(e){document.querySelector("#CargoBay ul").innerHTML=this.cargo.map(t=>`<li>${t.typename}</li>`).join(""),document.getElementById("CargoBay_Empty").style.display=this.cargo.length==0?"":"none",document.getElementById("CargoBay_NonEmpty").style.display=this.cargo.length==0?"none":""}};m(G,"CargoBay");var V=class extends v{onEnter(e){let n=document.querySelector("#Radar canvas").getContext("2d");ee(n,e.star)}};m(V,"Radar");function k(r,e){return r>e&&([r,e]=[e,r]),Math.floor(Math.random()*(e-r+1))+r}function R(r){return r[Math.floor(Math.random()*r.length)]}function z(r){return r.map(e=>({sort:Math.random(),value:e})).sort((e,t)=>e.sort-t.sort).map(e=>e.value)}function C(r){return[...Array(r).keys()]}var T=class r{isAlien=!1;rows=[];offsets=[];isPlayerShip=!1;playerOnShip=!1;playerX;playerY;toJSON(){return{isAlien:this.isAlien,offsets:this.offsets,rows:this.rows.map(e=>e.map(t=>t.toJSON()))}}static fromJSON(e){let t=new r;return t.isAlien=e.isAlien,t.offsets=e.offsets,t.rows=e.rows.map(n=>n.map(o=>E(o))),t}get gridSize(){if(this.isAlien)return{x0:0,x1:0,y0:0,y1:0,w:0,h:0};{let e=0,t=0;for(let n=0;n<this.rows.length;n++)e=Math.max(e,this.rows[n].length-this.offsets[n]),t=Math.max(t,this.offsets[n]);return{x0:0,x1:this.rows.length-1,y0:e,y1:t,w:this.rows.length,h:e+t+1}}}rowToXY(e,t){return this.isAlien?{x:0,y:0}:t>=this.offsets[e]?{x:e,y:1+(t-this.offsets[e])}:{x:e,y:t-this.offsets[e]}}get passage(){return this.isAlien?{x:0,y:0,w:0,h:0}:{x:0,y:0,w:this.rows.length,h:1}}oppositeComponent(e){for(let t=0;t<=this.rows.length;t++){let n=this.rows[t].indexOf(e);if(n>=0)return this.rows[this.rows.length-1-t][n]}}static randomShip(e){let n=Object.values(_).filter(s=>s.prototype instanceof v),o=Object.values(_).filter(s=>s.prototype instanceof d),a=new r;a.rows=[[],[],[],[]],a.offsets=[0,0,0,0];for(let s=0;s<e;s++){let h=k(0,3),l=R(n),M=new l;if(M instanceof G){let I=k(0,4);for(let Q=0;Q<I;Q++){let ae=R(o);M.cargo.push(new ae)}}a.rows[h].push(M)}for(let s=0;s<a.rows.length;s++)a.offsets[s]=k(0,a.rows[s].length);return a.balanceBallast(),a}balanceBallast(){if(!this.isAlien){let n=this.rows.length-1;for(var e=0;e<=n;e++)for(;this.offsets[e]<this.offsets[n-e];)this.rows[e].unshift(new c),this.offsets[e]++;for(var e=0;e<=n;e++)for(;this.rows[e].length<this.rows[n-e].length;)this.rows[e].push(new c);for(var e=0;e<=n;e++)for(;this.rows[e][0]instanceof c&&this.rows[n-e][0]instanceof c;)this.rows[e].shift(),this.rows[n-e].shift(),this.offsets[e]--,this.offsets[n-e]++;for(var e=0;e<=n;e++)for(;this.rows[e].at(-1)instanceof c&&this.rows[n-e].at(-1)instanceof c;)this.rows[e].pop(),this.rows[n-e].pop();for(var e=0;e<=n;e++)for(var t=0;t<=this.rows[e].length;t++)this.rows[e][t]instanceof c&&(this.rows[e][t].opposite=this.rows[n-e][t].typename)}}get topAirlock(){if(this.isAlien)return 0;{let e=0;for(let t=0;t<this.rows.length;t++)e=Math.max(e,this.rows[t].length-this.offsets[t]);for(let t=0;t<this.rows.length;t++)if(this.rows[t].length-this.offsets[t]==e)return t;return 0}}get bottomAirlock(){if(this.isAlien)return 0;{let e=Math.max(...this.offsets);return this.offsets.lastIndexOf(e)}}};var K=class{canBeHere=!1;canGoX=!1;canGoY=!1;ship;component},P=class{map=[];constructor(e,t){for(let n=0;n<=e;n++){this.map[n]=[];for(let o=0;o<=t;o++)this.map[n][o]=new K}}},j=class{x;y;map;box;human;canvas;onEnter;goX(e){return!this.map.map[this.x][this.y].canGoX||!this.map.map[this.x+e][this.y].canBeHere?!1:(this.x+=e,this.reposition(),this.onEnter(this.map.map[this.x][this.y].component),!0)}goY(e,t){return!t&&!this.map.map[this.x][this.y].canGoY||!this.map.map[this.x][this.y+e].canBeHere?!1:(this.y+=e,this.reposition(),this.onEnter(this.map.map[this.x][this.y].component),!0)}goUp(){this.goY(-1),this.human.style.transform="rotate(0deg)"}goDn(e){this.goY(1,e),this.human.style.transform="rotate(180deg)"}goLt(){this.goX(-1),this.human.style.transform="rotate(-90deg)"}goRt(){this.goX(1),this.human.style.transform="rotate(90deg)"}jumpTo(e,t,n,o){n!==void 0&&o!==void 0||(this.x=e,this.y=t,this.reposition(!0),this.onEnter(this.map.map[e][t].component))}reposition(e){e&&this.canvas.classList.add("notransition");let t=(this.x+.5)*i,o=this.box.offsetWidth/2-t;this.canvas.style.left=o+"px";let a=(this.y+.5)*i,h=this.box.offsetHeight/2-a;this.canvas.style.top=h+"px",e&&(this.canvas.offsetHeight,this.canvas.classList.remove("notransition"))}};var Y=class{walker;oneShipData;twoShipsData;myShip;putTwoShips(e,t){let n=e.gridSize,o=t.gridSize,a=e.bottomAirlock,s=t.topAirlock,h=Math.max(a,s)+1,l=n.h+1,M=h+Math.max(n.w-a,o.w-s),I=l+o.h+1;this.twoShipsData={ax0:h-a+n.x0,ay0:n.y0+1,airlock_x:h,airlock_y:l,bx0:h-s+o.x0,by0:l+o.y0+1,max_x:M,max_y:I}}drawTwoShips(e,t,n){this.putTwoShips(t,n);let o=this.twoShipsData,a=new P(o.max_x,o.max_y);this.walker.map=a,e.canvas.width=i*(o.max_x+1),e.canvas.height=i*(o.max_y+1),H(e,o.ax0,o.ay0,t,a),H(e,o.bx0,o.by0,n,a),Z(e,o.airlock_x,o.airlock_y,a)}drawMyShip(e){let t=this.oneShipData=this.myShip.gridSize,n=this.walker.map=new P(t.w+1,t.h+1);e.canvas.width=i*(t.w+2),e.canvas.height=i*(t.h+2),H(e,t.x0+1,t.y0+1,this.myShip,n)}detach(e){let t=this.walker.x-this.twoShipsData.bx0,n=this.walker.y-this.twoShipsData.by0+1;this.drawMyShip(e),this.walker.jumpTo(this.oneShipData.x0+1+t,this.oneShipData.y0+n),this.walker.goDn(!0)}attach(e,t){let n=this.walker.x-1-this.oneShipData.x0,o=this.walker.y-1-this.oneShipData.y0;this.drawTwoShips(e,t,this.myShip),this.walker.jumpTo(this.twoShipsData.bx0+n,this.twoShipsData.by0+o)}};var te=function(){let r=[b,S,B,O];for(var e=[[null,"water-mining","farming","burning"],["ice",null,"hunting","fire"],["fishy","bio-mining",null,"nuclear"],["frozen","hot mining","ice-farming",null]],t=[["ocean",null,b,"navy","blue"],["mining",null,S,"olive","yellow"]],n=0;n<4;n++)for(var o=0;o<4;o++)n!=o&&t.push([e[n][o],r[n],r[o],r[n].color,r[o].color]);return t}(),q=class{x;y;type;name;buys;sells;color_in;color_out;constructor(e,t,n){var o=te[n];this.x=e,this.y=t,this.type=n,this.name=o[0],this.buys=o[1],this.sells=o[2],this.color_in=o[3],this.color_out=o[4]}save(){return[this.x,this.y,this.type]}};function he(r,e,t){var n=t/2;return r<n+.6&&r>n-.6&&e<n+.6&&e>n-.6}function re(r){for(var e=z(C(te.length)),t=0;t<100;t++){for(var n=!1,o=[],a=z(C(r)),s=z(C(r)),h=r/2,l=0;l<r;l++)he(a[l]+.5,s[l]+.5,r)&&(n=!0),o.push([a[l]+.5,s[l]+.5,e[l]]);if(!n)return o}return console.error("should not be here"),[]}var me=["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","BlanchedAlmond","Blue","BlueViolet","Brown","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkGray","DarkGrey","DarkKhaki","DarkOrange","DarkOrchid","DarkSalmon","DarkSeaGreen","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DodgerBlue","FireBrick","FloralWhite","Fuchsia","Gainsboro","GhostWhite","Gold","Goldenrod","Gray","GreenYellow","Grey","Honeydew","HotPink","IndianRed","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenrodYellow","LightGray","LightGreen","LightGrey","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSlateGrey","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","MediumAquamarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MintCream","MistyRose","Moccasin","NavajoWhite","OldLace","Orange","OrangeRed","Orchid","PaleGoldenrod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Red","RosyBrown","RoyalBlue","Salmon","SandyBrown","Seashell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","SlateGrey","Snow","SpringGreen","SteelBlue","Tan","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"];function pe(r,e){for(var t=C(e).map(s=>[]),n=(e-1)/2,o=Math.floor(n);o<=Math.ceil(n);o++)for(var a=Math.floor(n);a<=Math.ceil(n);a++)t[o+1][a+1]=r;return t}var J=class{color;size;visited;x;y;bright;name;grid;planets;jobs;constructor(e){e||(e={c:R(me),s:k(5,9),p:!1,v:!1}),this.color=e.c,this.size=e.s,this.visited=e.v,this.x=this.y=this.size/2,this.bright=!1,this.name=this.color,this.size%2==0&&(this.bright=!0,this.name="bright "+this.name),this.grid=pe(this,this.size),e.p||(e.p=re(this.size)),this.planets=e.p.map(n=>new q(...n));for(var t of this.planets)this.grid[Math.floor(t.x)][Math.floor(t.y)]=t}save(){return{c:this.color,s:this.size,p:this.planets.map(e=>e.save()),v:this.visited}}};function f(r){let e=document.getElementById(r);if(!e)throw ReferenceError(`element ${r} not found`);return e}function Qe(r){let e=f(r);if(!(e instanceof HTMLInputElement))throw ReferenceError(`element ${r} is not input`);return e}(location.hostname=="localhost"||location.hostname=="127.0.0.1")&&new EventSource("/esbuild").addEventListener("change",()=>location.reload());var ce=T.randomShip(15),Ze=T.randomShip(35),ue={star:new J},u=new j,y=new Y;y.walker=u;var ne=f("myCanvas"),U=ne.getContext("2d");u.box=f("canvasBox");u.human=f("human");u.canvas=ne;u.onEnter=ye;function fe(){y.myShip=ce,y.drawMyShip(U),u.jumpTo(y.oneShipData.x0+1,y.oneShipData.y0+1),oe()}function oe(){y.attach(U,T.randomShip(25)),D("Docked to another ship")}fe();window.onkeypress=r=>{switch(r.key){case"w":u.goUp();break;case"a":u.goLt();break;case"s":u.goDn();break;case"d":u.goRt();break}};function ye(r){r&&(f("currentComponent").innerHTML=`#${r.typename} {display:block}`,r.cellName?f("componentLegend").innerText=`${r.cellName}: ${r.typename}`:f("componentLegend").innerText=`${r.typename}`,r.onEnter(ue))}function D(r){f("status").innerText=r}f("Airlock_Detach").onclick=()=>{y.detach(U),D("Docking to next ship in 5..."),setTimeout(()=>D("Docking to next ship in 4..."),1e3),setTimeout(()=>D("Docking to next ship in 3..."),2e3),setTimeout(()=>D("Docking to next ship in 2..."),3e3),setTimeout(()=>D("Docking to next ship in 1..."),4e3),setTimeout(()=>oe(),5e3)};})();
//# sourceMappingURL=script.js.map
